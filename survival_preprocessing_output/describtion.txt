================================================================================
SURVIVAL ANALYSIS VARIABLES - DETAILED EXPLANATION
Endometrial Cancer NSMP Challenge
================================================================================

This document explains the NEW variables created by the survival analysis 
preprocessing pipeline for time-to-event modeling.


================================================================================
1. DATE VARIABLES (Intermediate Processing)
================================================================================

These date variables are created from your original Spanish column names to
enable survival time calculations:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ New Variable Name               â”‚ Source Column (Spanish)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ pathological_diagnosis_date     â”‚ f_diag                                   â”‚
â”‚ recurrence_date                 â”‚ fecha_de_recidi                          â”‚
â”‚ death_date                      â”‚ f_muerte                                 â”‚
â”‚ last_followup_date              â”‚ Ultima_fecha                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PURPOSE: These date variables are converted to proper datetime format to 
calculate time intervals (in days) between events.


================================================================================
2. RECURRENCE-FREE SURVIVAL (RFS) VARIABLES â­
================================================================================

These are the PRIMARY outcome variables for Challenge Objective #1

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Variable     â”‚ Description                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ rfs_time     â”‚ TIME TO EVENT (in days)                                    â”‚
â”‚              â”‚ - Time from diagnosis to first recurrence, OR             â”‚
â”‚              â”‚ - Time from diagnosis to last follow-up (if no recurrence)â”‚
â”‚              â”‚                                                            â”‚
â”‚ rfs_event    â”‚ EVENT INDICATOR (binary: 0 or 1)                          â”‚
â”‚              â”‚ - 1 = Patient had recurrence (event occurred)             â”‚
â”‚              â”‚ - 0 = Patient censored (no recurrence observed)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

HOW rfs_time IS CALCULATED:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
IF patient had recurrence (recurrence = 1) AND recurrence_date exists:
    rfs_time = recurrence_date - pathological_diagnosis_date
    rfs_event = 1
ELSE (no recurrence or missing recurrence date):
    rfs_time = last_followup_date - pathological_diagnosis_date
    rfs_event = 0

EXAMPLE PATIENTS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Patient A: Diagnosed on 2020-01-01, recurred on 2022-06-15
    â†’ rfs_time = 895 days
    â†’ rfs_event = 1 (event occurred)

Patient B: Diagnosed on 2020-01-01, no recurrence, last seen 2024-12-01
    â†’ rfs_time = 1795 days
    â†’ rfs_event = 0 (censored - still disease-free at last contact)


================================================================================
3. OVERALL SURVIVAL (OS) VARIABLES â­
================================================================================

These are the PRIMARY outcome variables for Challenge Objective #2

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Variable     â”‚ Description                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ os_time      â”‚ TIME TO EVENT (in days)                                    â”‚
â”‚              â”‚ - Time from diagnosis to death, OR                        â”‚
â”‚              â”‚ - Time from diagnosis to last follow-up (if alive)        â”‚
â”‚              â”‚                                                            â”‚
â”‚ os_event     â”‚ EVENT INDICATOR (binary: 0 or 1)                          â”‚
â”‚              â”‚ - 1 = Patient died (event occurred)                       â”‚
â”‚              â”‚ - 0 = Patient censored (alive at last contact)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

HOW os_time IS CALCULATED:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
IF patient died (death_date exists OR current_patient_status indicates death):
    os_time = death_date - pathological_diagnosis_date
    os_event = 1
ELSE (patient is alive):
    os_time = last_followup_date - pathological_diagnosis_date
    os_event = 0

EXAMPLE PATIENTS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Patient C: Diagnosed on 2018-03-15, died on 2021-08-20
    â†’ os_time = 1253 days
    â†’ os_event = 1 (death occurred)

Patient D: Diagnosed on 2019-06-01, alive, last seen 2024-11-30
    â†’ os_time = 2008 days
    â†’ os_event = 0 (censored - alive at last contact)


================================================================================
4. CENSORING CONCEPT - CRITICAL FOR UNDERSTANDING ðŸ“š
================================================================================

CENSORING occurs when we don't observe the event of interest during the 
study period. This is NORMAL and EXPECTED in survival analysis!

RIGHT-CENSORED DATA:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
A patient is "censored" when:
  âœ“ They are still alive (for OS) at last follow-up
  âœ“ They are disease-free (for RFS) at last follow-up
  âœ“ They were lost to follow-up before experiencing the event
  âœ“ The study ended before they experienced the event

WHY CENSORING MATTERS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
We can't just ignore censored patients! They provide valuable information:
  â€¢ A patient alive at 5 years tells us they survived AT LEAST 5 years
  â€¢ We use their partial survival time in the analysis
  â€¢ Cox models and Kaplan-Meier curves handle censoring mathematically


================================================================================
5. TYPICAL SURVIVAL DATA STRUCTURE
================================================================================

Your processed dataset will look like this:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Patient ID  â”‚ rfs_time â”‚ rfs_event â”‚ os_time  â”‚ os_eventâ”‚ Feature_1  ...  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ P001        â”‚    365   â”‚     1     â”‚   1095   â”‚    0    â”‚    45.2    ...  â”‚
â”‚ P002        â”‚   1200   â”‚     0     â”‚   1200   â”‚    0    â”‚    52.1    ...  â”‚
â”‚ P003        â”‚    180   â”‚     1     â”‚    540   â”‚    1    â”‚    38.9    ...  â”‚
â”‚ P004        â”‚   2000   â”‚     0     â”‚   2000   â”‚    0    â”‚    61.3    ...  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INTERPRETATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
P001: Recurred after 1 year, still alive at 3 years
P002: Disease-free for 1200 days, censored (lost to follow-up)
P003: Recurred at 180 days, died at 540 days
P004: Disease-free and alive at 2000 days (censored)


================================================================================
6. QUALITY METRICS REPORTED
================================================================================

The preprocessing script reports these quality metrics:

For RFS (Recurrence-Free Survival):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  âœ“ Number of patients with valid RFS data
  âœ“ Number of recurrence events (rfs_event = 1)
  âœ“ Median follow-up time

For OS (Overall Survival):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  âœ“ Number of patients with valid OS data
  âœ“ Number of death events (os_event = 1)
  âœ“ Median follow-up time


================================================================================
7. WHAT HAPPENS TO INVALID DATA?
================================================================================

Patients are EXCLUDED from survival analysis if:
  âœ— Diagnosis date is missing
  âœ— Both event date AND last follow-up date are missing
  âœ— Calculated survival time is â‰¤ 0 days (impossible/data error)

These exclusions are automatic and reported in the preprocessing output.


================================================================================
8. OUTPUT FILES CONTAINING THESE VARIABLES
================================================================================

The new survival variables appear in these output files:

1. recurrence_free_survival_cleaned_survival_data.csv
   â”œâ”€ Contains: rfs_time, rfs_event, and selected top features
   â””â”€ Ready for: Cox regression, Random Survival Forests, DeepSurv

2. overall_survival_cleaned_survival_data.csv
   â”œâ”€ Contains: os_time, os_event, and selected top features
   â””â”€ Ready for: Cox regression, Random Survival Forests, DeepSurv

3. survival_analysis_results.txt
   â””â”€ Contains: Summary statistics and feature associations


================================================================================
9. HOW TO USE THESE VARIABLES IN MODELING
================================================================================

EXAMPLE - Cox Proportional Hazards Model:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
from lifelines import CoxPHFitter

# For RFS
cph = CoxPHFitter()
cph.fit(data, duration_col='rfs_time', event_col='rfs_event')

# For OS
cph = CoxPHFitter()
cph.fit(data, duration_col='os_time', event_col='os_event')


EXAMPLE - Kaplan-Meier Survival Curves:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
from lifelines import KaplanMeierFitter

kmf = KaplanMeierFitter()
kmf.fit(durations=data['rfs_time'], event_observed=data['rfs_event'])
kmf.plot_survival_function()


EXAMPLE - Random Survival Forest:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
from sksurv.ensemble import RandomSurvivalForest

# Create structured array for scikit-survival
y = np.array([(bool(e), t) for e, t in zip(data['rfs_event'], data['rfs_time'])],
             dtype=[('event', bool), ('time', float)])

rsf = RandomSurvivalForest(n_estimators=100)
rsf.fit(X, y)


================================================================================
10. KEY STATISTICAL CONCEPTS
================================================================================

HAZARD RATIO (HR):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â€¢ HR > 1: Increased risk of event (bad prognostic factor)
  â€¢ HR < 1: Decreased risk of event (protective factor)
  â€¢ HR = 1: No effect

Example: "Age HR=1.05" means each additional year increases hazard by 5%

CONCORDANCE INDEX (C-index):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â€¢ Similar to AUC for survival models
  â€¢ Range: 0.5 (random) to 1.0 (perfect)
  â€¢ C-index > 0.7 is considered good for survival models
  â€¢ Measures how well the model ranks patient survival times


================================================================================
SUMMARY - VARIABLES CREATED
================================================================================

PRIMARY SURVIVAL OUTCOMES (4 variables):
  1. rfs_time     â†’ Time to recurrence (days)
  2. rfs_event    â†’ Recurrence occurred? (0/1)
  3. os_time      â†’ Time to death (days)
  4. os_event     â†’ Death occurred? (0/1)

INTERMEDIATE DATE VARIABLES (4 variables):
  5. pathological_diagnosis_date
  6. recurrence_date
  7. death_date
  8. last_followup_date

TOTAL: 8 new variables created for survival analysis


================================================================================
QUESTIONS? TROUBLESHOOTING
================================================================================

Q: Why is my rfs_time different from os_time for the same patient?
A: RFS measures time to RECURRENCE, OS measures time to DEATH. A patient
   can recur (rfs_event=1) but still be alive (os_event=0).

Q: What if I have very few events (low event rate)?
A: This is common in cancer survival. You may need:
   - Longer follow-up periods
   - Combined endpoints
   - Penalized Cox regression (already included in preprocessing)

Q: Can I use regular machine learning models on survival data?
A: No! Standard ML models don't handle censoring. Use:
   - Cox regression
   - Random Survival Forests
   - DeepSurv / Deep survival networks
   - Survival SVMs

Q: How do I interpret a patient with rfs_event=0 and os_event=0?
A: This patient was CENSORED for both outcomes. They were:
   - Disease-free at last contact (no recurrence observed)
   - Alive at last contact (no death observed)
   They still contribute valuable information to the survival model!


================================================================================
END OF DOCUMENT
================================================================================
Generated by: Endometrial Cancer Survival Analysis Preprocessing Pipeline
Date: December 2025
For: NSMP Endometrial Cancer Challenge Team
================================================================================